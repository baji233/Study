# 二手交易平台

## API接口说明

- 微信小程序接口基准地址：`http://127.0.0.1:8888/shtp/api/user/`
- 后台管理员接口基准地址：`http://127.0.0.1:8888/shtp/api/admin/`
- 服务端已开启 CORS 跨域支持
- API 认证统一使用 Token 认证
- 需要授权的 API ，必须在请求头中使用 `Authorization` 字段提供 `token` 令牌, 将Token中的头部字符串Bearer删除后填入到授权的BearerToken中
- 使用 HTTP Status Code 标识状态
- 数据返回格式统一使用 JSON

### 支持的请求方法

- GET（SELECT）：从服务器取出资源（一项或多项）。
- POST（CREATE）：在服务器新建一个资源。
- PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。
- PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。
- DELETE（DELETE）：从服务器删除资源。
- HEAD：获取资源的元数据。
- OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。

### 通用返回状态说明

| *状态码* | *含义*                | *说明*                                              |
| -------- | --------------------- | --------------------------------------------------- |
| 200      | OK                    | 请求成功                                            |
| 201      | CREATED               | 创建成功                                            |
| 204      | DELETED               | 删除成功                                            |
| 400      | BAD REQUEST           | 请求的地址不存在或者包含不支持的参数                |
| 401      | UNAUTHORIZED          | 未授权                                              |
| 403      | FORBIDDEN             | 被禁止访问                                          |
| 404      | NOT FOUND             | 请求的资源不存在                                    |
| 422      | Unprocesable entity   | [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误 |
| 500      | INTERNAL SERVER ERROR | 内部错误                                            |
|          |                       |                                                     |

# 1. 微信小程序 (User)

## 1.1首页

### 1.1.1根据商品名模糊查询

- 请求路径: index/search

- 请求方法: get

- 请求参数:   (模糊查询二手商品名,  先调用老师的接口, 再调用此接口, 将响应数据拼接在一起, 此接口数据优先展示)

- | 参数名 | 参数说明   | 备注 |
  | ------ | ---------- | ---- |
  | query  | 搜索关键词 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.1.2获取首页的商品推荐

- 请求路径: index/recommend
- 请求方法: get
- 请求参数:   (查询recommend=1 || status=1的二手商品)
- 响应数据

```json
{
    "data": '{
        "略"
    }',
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.1.3获取推荐商品详细页

- 请求路径: index/detail

- 请求方法: get

- 请求参数: 无 

- 响应参数: 

- | 参数名  | 参数说明 | 备注 |
  | ------- | -------- | ---- |
  | goodsId | 商品id   |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 1.2上架

### 1.2.1新增二手商品

- 请求路径: release

- 请求方法: put

- 请求参数:   (状态码status=0表示审核中 , 还有上架时间)

- | 参数名    | 参数说明 | 备注   |
  | --------- | -------- | ------ |
  | goodsName | 商品名称 |        |
  |           |          |        |
  |           |          |        |
  |           |          |        |
  |           |          |        |
  |           |          |        |
  | time      | 上架时间 | 时间戳 |
  |           |          |        |

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.2.2根据商品id查询评论

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无 

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.2.3新增评论

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无 

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 1.3消息

### 1.3.1 新增聊天消息

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.3.2 查询我的聊天消息

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 1.4我的

### 1.4.1新增订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.2删除订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.3修改订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.4查询待付款订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.5查询已付款订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.6查询待评价订单

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.7查询我发布的商品

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.8查询个人信息

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.9修改个人信息

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.10查询我的收藏

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.11取消收藏商品

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.12用户登录

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无  (判断如果status=-1是封禁状态则不给予登录)

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.13退出登录

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 1.4.14用户注册

- 请求路径: userCount

- 请求方法: get

- 请求参数: 无  (判断如果status=-1是封禁状态则不给予登录)

- 响应参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | count  | 用户总数 |      |

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 1.5图片上传

- 请求路径：upload
- 请求方法：post
- 请求参数

| 参数名 | 参数说明 | 备注 |
| ------ | -------- | ---- |
| file   | 上传文件 |      |

- 响应数据

```
{
    "data": {
        "tmp_path": "tmp_uploads/ccfc5179a914e94506bcbb7377e8985f.png",
        "url": "http://127.0.0.1:8888tmp_uploads/ccfc5179a914e94506bcbb7377e8985f.png"
    },
    "meta": {
        "msg": "上传成功",
        "status": 200
    }
}
```



# 2.后台管理系统 (Admin)

## 2.1数据展示

### 2.1.1查询用户总数量

- 请求路径: show/user
- 请求方法: get
- 请求参数: 无

- 响应数据

```json
{
    "data": {
        "count": 11
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.1.2查询当前在线人数

- 请求路径: show/online
- 请求方法: get
- 请求参数: 无
- 响应参数: 

- 响应数据

```json
{
    "data": {
        "count": 8
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.1.3查询用户上架的商品数量

- 请求路径: show/goods
- 请求方法: get
- 请求参数: 无

- 响应数据

```json
{
    "data": {
        "count": 15
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.1.4查询最近的一条商品评价

- 请求路径: show/comment

- 请求方法: get

- 请求参数: 无

- 响应参数: 

- | 参数名   | 参数说明 | 备注 |
  | -------- | -------- | ---- |
  | head_url | 用户头像 |      |
  | comment  | 评论内容 |      |
  | time     | 评论时间 |      |

- 响应数据

```json
{
    "data": {
        "head_url": "https://up.enterdesk.com/edpic/69/da/60/69da608c3daf05186c30bc0b5d09ca3d.jpg",
        "comment": "非常不错实物和图片一模一样",
        "time": "2023/6/20"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 2.2上架审核

### 2.2.1查询需要审核的二手商品

- 请求路径: audit/select

- 请求方法: get

- 请求参数:   (查询表t_goods_user中字段status=0的二手商品)

- | 参数名   | 参数说明           | 备注                                       |
  | -------- | ------------------ | ------------------------------------------ |
  | pageNum  | 当前页码值         | 【可选参数】如果不传递，则默认获取所有分类 |
  | pageSize | 每页显示多少条数据 | 【可选参数】如果不传递，则默认获取所有分类 |

- 响应参数: 

- | 参数名      | 参数说明               | 备注 |
  | ----------- | ---------------------- | ---- |
  | describe    | 商品描述               |      |
  | picture_url | 图片路径(用逗号隔开)   |      |
  | category    | 商品分类               |      |
  | category    | 此二手商品所属的用户id |      |
  | credit      | 用户信用值             |      |
  | total       | 查询结果的总条数       |      |
  
- 响应数据

```json
{
    "data": {
        "goodsName": "美短猫",
        "describe": "呆呆傻傻的一只",
        "pictureUrl": "https://pic1.zhimg.com/v2-cb7d2218ecb9f7d1486d9d549c5235d8_b.jpg,https://pic4.zhimg.com/80/v2-3689d96d0c0b6f4b5edf7c7efbcefd67_720w.webp",
        "category": "宠物",
        "price": 1000,
        "uId": 3,
        "credit": 80,
        "total": 1
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.2.2审核二手商品

- 请求路径: audit/:goodsId

- 请求方法: put

- 请求参数:   (根据商品id修改此二手商品的字段status=-1或status=1)

- | 参数名  | 参数说明             |
  | ------- | -------------------- |
  | goodsId | 二手商品id           |
  | isAudit | -1审核失败/1审核通过 |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 2.3用户管理

### 2.3.1查询用户信息

- 请求路径: user/select

- 请求方法: get

- 请求参数:   (查询所有用户)

- | 参数名   | 参数说明           | 备注                                       |
  | -------- | ------------------ | ------------------------------------------ |
  | pageNum  | 当前页码值         | 【可选参数】如果不传递，则默认获取所有分类 |
  | pageSize | 每页显示多少条数据 | 【可选参数】如果不传递，则默认获取所有分类 |

- 响应参数:

- | 参数名 | 参数说明         | 备注 |
  | ------ | ---------------- | ---- |
  | total  | 查询结果的总条数 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.3.2删除用户

- 请求路径: user/delete/:userId

- 请求方法: delete

- 请求参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | userId | 用户id   |      |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 204
    }
}
```



### 2.3.2封禁 / 解封用户

- 请求路径: user/banned/:userId

- 请求方法: put

- 请求参数: 

- | 参数名 | 参数说明     | 备注 |
  | ------ | ------------ | ---- |
  | userId | 用户id       |      |
  | status | -1封禁/0解封 |      |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.3.3修改用户信息

- 请求路径: user/update/:userId

- 请求方法: put

- 请求参数:   

- | 参数名   | 参数说明 | 备注     |
  | -------- | -------- | -------- |
  | userId   | 用户id   | 不能为空 |
  | name     |          |          |
  | password |          |          |
  | sex      |          |          |
  | credit   | 信用值   |          |
  | pay      | 账户余额 |          |
  
- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 201
    }
}
```



### 2.3.4新增用户

- 请求路径: user/add

- 请求方法: post  (用户要有默认头像)

- 请求参数:   

- | 参数名   | 参数说明 | 备注     |
  | -------- | -------- | -------- |
  | userId   | 用户id   | 不能为空 |
  | name     |          |          |
  | password |          |          |
  | sex      |          |          |
  | credit   | 信用值   |          |
  | pay      | 账户余额 |          |
  
- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 201
    }
}
```

### 2.3.5搜索用户

- 请求路径: user/search

- 请求方法: get

- 请求参数:   (模糊查询用户名, 先调用老师的接口, 再调用此接口, 将响应数据拼接在一起, 此接口数据优先展示)

- | 参数名   | 参数说明           | 备注 |
  | -------- | ------------------ | ---- |
  | query    | 搜索关键词         |      |
  | pageNum  | 当前页码值         |      |
  | pageSize | 每页显示多少条数据 |      |
  
- 响应参数

- | 参数名 | 参数说明         | 备注 |
  | ------ | ---------------- | ---- |
  | total  | 查询结果的总条数 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 2.4消息管理

### 2.4.1删除一条消息

- 请求路径: chat/delete/:chatId

- 请求方法: delete

- 请求参数: 

- | 参数名 | 参数说明 | 备注 |
  | ------ | -------- | ---- |
  | chatId | 消息id   |      |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 204
    }
}
```



### 2.4.2根据用户id查询消息

- 请求路径: chat/select/:userId

- 请求方法: get

- 请求参数:   (查询的此用户相关的全部消息)

- | 参数名   | 参数说明           | 备注 |
  | -------- | ------------------ | ---- |
  | userId   | 用户id             |      |
  | pageNum  | 当前页码值         |      |
  | pageSize | 每页显示多少条数据 |      |

- 响应参数

- | 参数名 | 参数说明         | 备注 |
  | ------ | ---------------- | ---- |
  | total  | 查询结果的总条数 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 2.5宝贝管理

### 2.5.1查询全部二手商品

- 请求路径: goods/select

- 请求方法: get  (查询t_goods_user表)

- 请求参数: 

- | 参数名   | 参数说明           | 备注                                       |
  | -------- | ------------------ | ------------------------------------------ |
  | pageNum  | 当前页码值         | 【可选参数】如果不传递，则默认获取所有分类 |
  | pageSize | 每页显示多少条数据 | 【可选参数】如果不传递，则默认获取所有分类 |

- 响应参数:

- | 参数名 | 参数说明         | 备注 |
  | ------ | ---------------- | ---- |
  | total  | 查询结果的总条数 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.5.2新增二手商品

- 请求路径: goods/add

- 请求方法: post

- 请求参数:  

- | 参数名     | 参数说明             | 备注 |
  | ---------- | -------------------- | ---- |
  | goodsName  | 名称                 |      |
  | uId        | 二手商品所属的用户id |      |
  | describe   | 描述                 |      |
  | pictureUrl | 图片url              |      |
  | category   | 分类                 |      |
  | price      | 价格                 |      |
  | recommend  | 是否推荐 (1是/0否)   |      |
  | status     | 1(无需审核)          |      |
  | time       | 上架时间             |      |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 201
    }
}
```



### 2.5.3删除二手商品

- 请求路径: goods/delete/:goodsId

- 请求方法: delete

- 请求参数: 

- | 参数名  | 参数说明   | 备注     |
  | ------- | ---------- | -------- |
  | goodsId | 二手商品id | 不能为空 |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 204
    }
}
```



### 2.5.4修改二手商品

- 请求路径: goods/update/:goodsId

- 请求方法: put

- 请求参数: 

- | 参数名     | 参数说明             | 备注     |
  | ---------- | -------------------- | -------- |
  | goodsId    | 二手商品id           | 不能为空 |
  | goodsName  | 名称                 | 不能为空 |
  | uId        | 二手商品所属的用户id | 不能为空 |
  | describe   | 描述                 |          |
  | pictureUrl | 图片url              |          |
  | category   | 分类                 |          |
  | price      | 价格                 | 不能为空 |
  | recommend  | 是否推荐 (1是/0否)   |          |
  | status     | 1(无需审核)          |          |
  | time       | 上架时间             |          |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.5.5推荐 / 不推荐

- 请求路径: goods/recommend/:goodsId

- 请求方法: put

- 请求参数: 

- | 参数名    | 参数说明           | 备注 |
  | --------- | ------------------ | ---- |
  | goodsId   | 二手商品id         |      |
  | recommend | 是否推荐 (1是/0否) |      |

- 响应数据

```json
{
    "data": null,
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



### 2.5.6搜索二手商品

- 请求路径: goods/search

- 请求方法: get

- 请求参数:   (模糊查询二手商品名,  先调用老师的接口, 再调用此接口, 将响应数据拼接在一起, 此接口数据优先展示)

- | 参数名   | 参数说明           | 备注 |
  | -------- | ------------------ | ---- |
  | query    | 搜索关键词         |      |
  | pageNum  | 当前页码值         |      |
  | pageSize | 每页显示多少条数据 |      |
  
- 响应参数:

- | 参数名 | 参数说明         | 备注 |
  | ------ | ---------------- | ---- |
  | total  | 查询结果的总条数 |      |

- 响应数据

```json
{
    "data": {
        "略"
    },
    "meta": {
        "msg": "success",
        "status": 200
    }
}
```



## 2.6评论管理



























